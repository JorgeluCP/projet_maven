<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <!-- =============================================================== -->
    <!-- Informations du projet -->
    <!-- =============================================================== -->
    <!-- ===== Informations Maven ===== -->
    <groupId>org.exemple.demo</groupId>
    <artifactId>projet_maven</artifactId>
    <version>1.0-SNAPSHOT</version><!-- SNAPSHOT (quand on d√©veloppe) √† enlever quand on fera une release-->

    <!-- ===== Informations g√©n√©rales du projet ===== -->
    <name>Mon Application</name><!-- nom du projet -->
    <description>La super application qui sert √† faire ceci/cela...</description>
    <url>http://www.exemple.org/mon-appli</url><!-- URL du projet ou de l'application en production. -->

    <!-- ===== Organisation g√©rant le projet===== -->
    <organization>
        <name>Mon Entreprise</name>
        <url>http://www.exemple.org</url>
    </organization>

    <!-- ===== Licences
    Si vous travaillez comme prestataire de service, vous mettrez ici les informations du client pour lequel
    vous d√©veloppez le projet.
    ===== -->
    <licenses>
        <license>
            <name>Apache License, Version 2.0</name>
            <url>https://www.apache.org/licenses/LICENSE-2.0.txt</url>
        </license>
    </licenses>

    <!-- =============================================================== -->
    <!-- Properties
     il est possible d'ajouter un peu de g√©n√©ricit√© dans tout cela gr√¢ce aux propri√©t√©s.
     Celles-ci sont des sortes de constantes. Elles sont remplac√©es par leur valeur lors de l'ex√©cution de Maven en
     utilisant la notation ${maPropriete} (qui sera remplac√©e par la valeur de la propri√©t√© maPropriete).

     Voici un exemple d'utilisation des propri√©t√©s : je voudrais utiliser dans mon projet un framework compos√© de
     plusieurs biblioth√®ques mais ne d√©finir qu'une seule fois sa version.
     =============================================================== -->

    <properties>
        <maPropriete>la valeur de la propri√©t√©</maPropriete>
        <uneAutrePropriete>la valeur de la propri√©t√©</uneAutrePropriete>

        <apache.struts.version>2.5.10.1</apache.struts.version>
    </properties>

    <!--
    Voici un exemple d'utilisation des propri√©t√©s : je voudrais utiliser dans mon projet un framework compos√© de
    plusieurs biblioth√®ques mais ne d√©finir qu'une seule fois sa version.
    lEs noms des balises que l'on met dans properties, on peut les choisir nous memes

    En plus des propri√©t√©s que vous pouvez d√©finir vous-m√™me gr√¢ce √† la balise <properties>, il existe √©galement des propri√©t√©s pr√©-d√©finies :

     * project.basedir : donne le chemin vers le r√©pertoire de base du projet, c'est-√†-dire la racine de votre projet o√π se trouve le fichier pom.xml.

     * project.baseUri : donne le chemin vers le r√©pertoire de base du projet, mais sous forme d'URI.

     * maven.build.timestamp : donne l'horodatage du lancement du build Maven.
     <properties>
          <maven.build.timestamp.format>yyyy-MM-dd'T'HH:mm:ss'Z'</maven.build.timestamp.format>
     </properties>
    -->

    <dependencies>
        <!-- ===== Apache Struts ===== -->
        <dependency>
            <groupId>org.apache.struts</groupId>
            <artifactId>struts2-core</artifactId>
            <version>${apache.struts.version}</version>
        </dependency>
        <dependency>
            <groupId>org.apache.struts</groupId>
            <artifactId>struts2-json-plugin</artifactId>
            <version>${apache.struts.version}</version>
        </dependency>
    </dependencies>

    <!--
     Propri√©t√©s particuli√®res
    ************************
     Vous pouvez aussi acc√©der √† des propri√©t√©s particuli√®res gr√¢ce aux pr√©fixes suivants :

     env. : permet de renvoyer la valeur d'une variable d'environnement. Par exemple, ${env.PATH} renvoie la valeur
     de la variable d'environnement PATH.

     project. : renvoie la valeur d'une balise dans le fichier pom.xml du projet, en utilisant le point (.) comme
     s√©parateur de chemin pour les sous-balises. Par exemple,

         <project>
             <organization>
                  <name>1.0</name>
             </organization>
         </project>

     est accessible via               ${project.organization.name}.

     settings. : renvoie la valeur d'une balise dans le(s) fichier(s) settings.xml utilis√©(s) par Maven. Utilise la
     notation point√©e comme pour les propri√©t√©s de project.

     java. : renvoie la valeur d'une propri√©t√© syst√®me de Java. Ces propri√©t√©s sont les m√™mes que celles accessibles
     via java.lang.System.getProperties(). Par exemple, ${java.version} renvoie la version de Java. Pour plus de d√©tails,
     consultez la JavaDoc.
    -->

    <!--
    La plupart des conventions √©tablies par Maven (chemin des sources, chemin de g√©n√©ration...) sont mises en ≈ìuvre
    gr√¢ce au Super POM. En effet, de base, le POM d'un projet h√©rite du Super POM qui d√©finit les valeurs par d√©faut
    que va utiliser Maven.

   *********************************************************************************************************************
    Ne vous √©tonnez donc pas si ${project.build.directory} vous renvoie une valeur alors que vous ne l'avez pas d√©finie dans
    votre fichier pom.xml. Elle provient du Super POM !
    *******************************************************************************************************************

    Enfin, sachez que certaines propri√©t√©s permettent de d√©finir des configurations par d√©faut de Maven ou de certains
    plugins. C'est le cas par exemple de la propri√©t√© project.build.sourceEncoding ajout√©e par l'arch√©type quickstart
    lors du mvn archetype:generate. Je vous en parlerai en temps voulu dans les diff√©rents chapitres de ce cours.
    -->

    <!-- =========================================================================================================== -->
    <!--                                                    Build                                                    -->
    <!-- =========================================================================================================== -->
    <!--
    En plus des informations de base et des propri√©t√©s, vous pouvez param√©trer les diff√©rents √©l√©ments du processus de
    construction de Maven, qu'on appelle le build.

     J'introduis simplement le build dans ce chapitre, car la deuxi√®me partie du cours lui est consacr√©e. Je rentrerai
     plus dans le d√©tail √† ce moment-l√†. :)

     La configuration du build se fait gr√¢ce √† la balise <build> et ses sous-balises.

     Voici un exemple o√π je d√©finis un chemin de sortie autre que celui par d√©faut (${project.basedir}/target) :
    -->

    <!--
                                 <build>
                                     <directory>${project.basedir}/output</directory>
                                 </build>
    -->
    <!--
      Si je reprends le premier projet Maven que nous avons cr√©√© dans le chapitre pr√©c√©dant, je peux, par exemple,
      rendre le JAR g√©n√©r√© ex√©cutable en demandant √† Maven d'indiquer la classe Main dans le Manifest du JAR :
    -->
    <build>
        <!-- <directory>${project.basedir}/output</directory> -->
        <!-- Gestion des plugins (version) -->
        <pluginManagement>
            <plugins>
                <!-- Plugin responsable de la g√©n√©ration du fichier JAR -->
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-jar-plugin</artifactId>
                    <version>3.0.2</version>
                </plugin>
            </plugins>
        </pluginManagement>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-jar-plugin</artifactId>
                <configuration>
                    <archive>
                        <!-- Cr√©ation du Manifest pour la d√©finition de la classe Main -->
                        <manifest>
                            <mainClass>org.exemple.demo.App</mainClass>
                        </manifest>
                    </archive>
                </configuration>
            </plugin>
        </plugins>

        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
        <!--
        <resources>
            <resource>
                <directory>src/main/resources/filtered</directory>
                <filtering>true</filtering>
            </resource>
            <resource>
                <directory>src/main/resources/raw</directory>
                <filtering>false</filtering>
            </resource>
        </resources>
        -->
    </build>

    <!-- =========================================================================================================== -->
    <!--                                Filtrer des fichiers ressources                                              -->
    <!-- =========================================================================================================== -->
    <!--
     Les fichiers ressources sont des fichiers qui n'ont pas √† √™tre compil√©s, mais simplement copi√©s dans le livrable
     g√©n√©r√© par Maven. Par convention, ces fichiers se trouvent dans le r√©pertoire src/main/resources (r√©pertoire √†
     cr√©er si besoin).

     Un peu plus haut, je vous disais qu'il √©tait possible de dire √† Maven de remplacer les propri√©t√©s par leur valeurs
     dans des fichiers en filtrant les fichiers ressource.

     Voyons tout de suite un exemple. Vous avez un fichier info.properties charg√© par votre application et vous voulez
     mettre dans ce fichier une propri√©t√© contenant la version du projet :

              1) Vous mettez ce fichier dans le r√©pertoire src/main/resources.

              2) Dans ce fichier, vous utilisez la m√™me syntaxe que dans le fichier pom.xml :

                      # Propri√©t√© contenant la version du projet
                      org.exemple.demo.version=${project.version}

              3) Ensuite vous indiquez √† Maven, dans le fichier pom.xml, de filtrer les fichiers du r√©pertoire
                 src/main/resources avec la balise <filtering> :

                      <resources>
                          <resource>
                              <directory>src/main/resources</directory>
                              <filtering>true</filtering>
                          </resource>
                      </resources>


     Si vous avez des fichiers √† ne pas filtrer dans le r√©pertoire src/main/resources, il est possible de faire des
     sous-r√©pertoires dans ce dernier afin d'organiser vos fichiers.


                  Voici un exemple o√π seulement les fichiers du sous-dossier filtered doivent √™tre filtr√©s :
                  üóÅ src/main/resources
                  ‚îú‚îÄ‚îÄ üóÅ filtered
                  ‚îÇ   ‚îî‚îÄ‚îÄ üóé info.properties
                  ‚îî‚îÄ‚îÄ üóÅ raw
                      ‚îî‚îÄ‚îÄ üóé fichierX

                                    <build>
                                        <resources>
                                            <resource>
                                                <directory>src/main/resources/filtered</directory>
                                                <filtering>true</filtering>
                                            </resource>
                                            <resource>
                                                <directory>src/main/resources/raw</directory>
                                                <filtering>false</filtering>
                                            </resource>
                                        </resources>
                                    </build>

        Je vous invite √† consulter la documentation car le filtrage ne s'arr√™te pas √† cela. Il est notamment possible
        d'importer la valeur des propri√©t√©s utilis√©es lors du filtrage depuis des fichiers properties externes avec la
        balise <filters>.

        Si vous voulez aller plus loin sur la configuration du build dans le POM, vous pouvez consulter la documentation.
 -->

    <!-- =========================================================================================================== -->
    <!--                                        Les profils                                                          -->
    <!-- =========================================================================================================== -->
    <!--
    Les profils permettent de cr√©er des options dans le build Maven.

    Vous pouvez par exemple envisager deux environnements cibles (un de test, un de production) et embarquer, dans le JAR
    g√©n√©r√©, des fichiers de configurations diff√©rents en fonction de la cible. Pour cela, pas besoin de mettre √† la main les
    bons fichiers dans le r√©pertoire src/main/resources avant le build. Il suffit de cr√©er deux profils (test et prod),
    chacun d√©finissant un r√©pertoire de fichiers ressources diff√©rent :
    -->
    <profiles>
        <!-- Profil pour l'environnement de test -->
        <profile>
            <id>test</id>
            <build>
                <resources>
                    <resource>
                        <directory>src/main/resources/conf-test</directory>
                    </resource>
                </resources>
            </build>
        </profile>
        <!-- Profil pour l'environnement de production -->
        <profile>
            <id>prod</id>
            <build>
                <resources>
                    <resource>
                        <directory>src/main/resources/conf-prod</directory>
                    </resource>
                </resources>
            </build>
        </profile>
    </profiles>


    <!--
       Il ne vous reste plus qu'√† mettre les fichiers de configuration de test et de production dans leur r√©pertoire
       ressource respectif et d'activer le bon profil lors du lancement du build Maven gr√¢ce √† l'option -P :

       # Pour construire un livrable pour l'environnement de test :
       mvn package -P test

       # Pour construire un livrable pour l'environnement de production :
       mvn package -P prod
    -->

    <!-- =========================================================================================================== -->
    <!--                                     Activation automatique des profils                                      -->
    <!-- =========================================================================================================== -->
    <!--
    Les profils peuvent √©galement √™tre activ√©s automatiquement en fonction de certains crit√®res d√©finis dans la
    sous-balise <activation> :


                          <!- Profil activ√© automatiquement si la version du JDK est 1.8
                               et sous-versions mineures (1.8.0_131 par exemple)
                          <profile>
                              <activation>
                                  <jdk>1.8</jdk>
                              </activation>

                          </profile>

                          - Profil activ√© automatiquement si la propri√©t√© syst√®me "environnement" vaut "test" -
                          <profile>
                              <activation>
                                  <property>
                                      <name>environnement</name>
                                      <value>test</value>
                                  </property>
                              </activation>

                          </profile>

    Vous comprendrez encore mieux l'int√©ret des profils quand vous aborderez la deuxi√®me partie de ce cours, dans
    laquelle je vous montrerai comment fonctionne le build Maven et comment l'adapter parfaitement √† votre projet.

    PASSER A projet_maven2
    -->

</project>
